<script>
/*jslint browser, devel, es6, maxlen: 80*/
/*global google, jQuery, Sortable*/

(function (jQuery, google, Sortable) {
    "use strict";

    const restaurants = (function ($) {
        "use strict";

        const restaurantsObj = {
            "--TBD--": "https://www.google.com/",
            "BERTUCCI'S": "http://www.bertuccis.com/",
            "PAPA GINOS": "https://www.papaginos.com/menu"
        };

        function changeUrl() {
            $("form#newGroupOrder a").attr("href", restaurantsObj[this.value]);
        }

        function get() {
            return restaurantsObj;
        }

        return {
            changeUrl,
            get
        };

    }(jQuery));

    const orders = (function () {
        "use strict";

        let ordersArr = [];

        function add(newOrder) {
            ordersArr.push(newOrder);
        }
        
        function display() {
//                    $("table tbody").append(
//                        "<tr>" +
//                        "<td>" + 1 + "</td>" +
//                        "<td>" + "Griffin,Kevin" + "</td>" +
//                        "<td>" + formObj.orderText + "</td>" +
//                        "<td>" + formObj.orderPrice + "</td>" +
//                        "<td>" + formObj.orderPrice * 0.07 + "</td>" +
//                        "<td>" + formObj.orderPrice + "</td>" +
//                        "</tr>"
//                    );
//                    $("table").show();
        }

        return {
            add,
            display
        };

    }());

    const enterEdit = (function ($, google, orders, restaurants) {
        "use strict";

        let formArr = [];
        let formObj = {};

        function formArrToObj(total, curVal) {
            total[curVal.name] = curVal.value;
            return total;
        }

        Object.keys(restaurants.get()).forEach(function (key) {
            $("select#restaurant").append(
                "<option>" + key + "</option>"
            );
        });

        function displayForm() {
            $(function () {
                $("button#newGroupOrder").hide();
                $("form#newGroupOrder").show();
                $("form#newGroupOrder").submit(function (event) {
                    event.preventDefault();
                    $("form#newGroupOrder").hide();
                    $("button#newGroupOrder").show();
                    formArr = $("form#newGroupOrder").serializeArray();
                    formObj = formArr.reduce(formArrToObj, {});
                    google.script.run
                    .withSuccessHandler(orders.display)
                    .fileOrderToSpreadsheet(formObj);
                });
                $("select#restaurant option").click(restaurants.changeUrl);
            });
        }

        function getFormData() {
            return formObj;
        }

        return {
            displayForm,
            getFormData
        };

    }(jQuery, google, orders, restaurants));

    //**************************************************************************

    function main(dataObj, $) {
        $("h2").text(dataObj.projectName);
        // TODO: if group orders, display them
        // ---group orders code goes here---
        $("button#newGroupOrder").click(enterEdit.displayForm);
    }

    //**************************************************************************

    jQuery(function startUp() {
        google.script.run
        .withSuccessHandler(main)
        .withUserObject(jQuery)
        .getData();
    });

}(jQuery, google, Sortable));
</script>